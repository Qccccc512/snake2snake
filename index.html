<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>蛇对蛇 - OOP版本</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- 用户选择界面 -->
    <div class="modal" id="userSelectModal">
        <div class="modal-content user-select-content">
            <h2>🎮 选择用户</h2>
            
            <div class="mode-selector">
                <button class="mode-btn active" data-mode="2players">双人对战</button>
                <button class="mode-btn" data-mode="ai">AI对战</button>
            </div>

            <!-- AI难度选择 -->
            <div class="difficulty-selector" id="difficultySelector" style="display: none;">
                <div class="difficulty-label">AI难度：</div>
                <div class="difficulty-buttons">
                    <button class="difficulty-btn active" data-difficulty="easy">
                        <span class="difficulty-name">简单</span>
                        <span class="difficulty-desc">反应慢，策略简单</span>
                    </button>
                    <button class="difficulty-btn" data-difficulty="normal">
                        <span class="difficulty-name">中等</span>
                        <span class="difficulty-desc">平衡的挑战</span>
                    </button>
                    <button class="difficulty-btn" data-difficulty="hard">
                        <span class="difficulty-name">困难</span>
                        <span class="difficulty-desc">智能预测，积极阻挡</span>
                    </button>
                </div>
            </div>

            <!-- 玩家1选择 -->
            <div class="player-select">
                <h3 class="player1-color">玩家1 (WASD)</h3>
                <select id="player1Select" class="user-select">
                    <option value="">-- 选择用户 --</option>
                </select>
            </div>

            <!-- 玩家2选择（双人模式） -->
            <div class="player-select" id="player2SelectContainer">
                <h3 class="player2-color">玩家2 (方向键)</h3>
                <select id="player2Select" class="user-select">
                    <option value="">-- 选择用户 --</option>
                </select>
            </div>

            <div class="user-actions">
                <button id="createUserBtn" class="btn btn-secondary">
                    ➕ 创建新用户
                </button>
                <button id="confirmUserBtn" class="btn btn-primary">
                    ✓ 确认开始游戏
                </button>
            </div>

            <!-- 用户列表 -->
            <div class="user-list-container">
                <h3>现有用户</h3>
                <div id="userList" class="user-list"></div>
            </div>
        </div>
    </div>

    <!-- 创建用户弹窗 -->
    <div class="modal" id="createUserModal" style="display: none;">
        <div class="modal-content small-modal">
            <h2>创建新用户</h2>
            <input type="text" id="newUserName" class="input-text" placeholder="输入用户名" maxlength="20">
            <div class="modal-actions">
                <button id="cancelCreateBtn" class="btn btn-secondary">取消</button>
                <button id="confirmCreateBtn" class="btn btn-primary">创建</button>
            </div>
        </div>
    </div>

    <!-- 游戏主界面 -->
    <div class="game-container" id="gameContainer" style="display: none;">
        <h1>🐍 蛇对蛇</h1>

        <!-- 信息面板 -->
        <div class="info-panel">
            <div class="player-info">
                <div class="player-name player1-color player1-name">玩家1</div>
                <div class="score-display">分数: <span id="score1">0</span></div>
                <div class="length-display">长度: <span id="length1">3</span></div>
            </div>
            <div class="player-info">
                <div class="player-name player2-color player2-name">玩家2</div>
                <div class="score-display">分数: <span id="score2">0</span></div>
                <div class="length-display">长度: <span id="length2">3</span></div>
            </div>
        </div>

        <!-- 计时器 -->
        <div class="timer-panel">
            <span id="timer">02:00</span>
        </div>

        <!-- Canvas容器 -->
        <div class="canvas-container">
            <canvas id="gameCanvas" width="512" height="512"></canvas>
            <div class="status-message" id="statusMessage">
                准备开始游戏<br>按空格键或点击开始按钮
            </div>
            <div class="respawn-timer" id="respawnTimer1"></div>
            <div class="respawn-timer" id="respawnTimer2"></div>
        </div>

        <!-- 控制按钮 -->
        <div class="control-panel">
            <button id="startBtn" class="control-btn">开始游戏</button>
            <button id="pauseBtn" class="control-btn" disabled>暂停</button>
            <button id="resetBtn" class="control-btn">重置游戏</button>
            <button id="achievementBtn" class="control-btn">🏆 成就</button>
            <button id="changeUserBtn" class="control-btn">👤 切换用户</button>
        </div>

        <!-- 移动端虚拟控制器 -->
        <div class="virtual-controls">
            <div class="virtual-controls-container">
                <!-- 玩家1控制器 -->
                <div class="player1-controls">
                    <div class="control-pad-label">玩家1</div>
                    <div class="control-pad">
                        <div class="control-btn-virtual btn-up" data-key="w">W</div>
                        <div class="control-btn-virtual btn-left" data-key="a">A</div>
                        <div class="control-btn-virtual btn-center">●</div>
                        <div class="control-btn-virtual btn-right" data-key="d">D</div>
                        <div class="control-btn-virtual btn-down" data-key="s">S</div>
                    </div>
                </div>
                
                <!-- 玩家2控制器（双人模式） -->
                <div class="player2-controls" id="player2Controls">
                    <div class="control-pad-label">玩家2</div>
                    <div class="control-pad">
                        <div class="control-btn-virtual btn-up" data-key="ArrowUp">↑</div>
                        <div class="control-btn-virtual btn-left" data-key="ArrowLeft">←</div>
                        <div class="control-btn-virtual btn-center">●</div>
                        <div class="control-btn-virtual btn-right" data-key="ArrowRight">→</div>
                        <div class="control-btn-virtual btn-down" data-key="ArrowDown">↓</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 成就面板 -->
    <div class="modal" id="achievementModal" style="display: none;">
        <div class="modal-content achievement-content">
            <button class="modal-close" id="achievementCloseBtn">×</button>
            <h2>🏆 成就系统</h2>
            
            <!-- 成就统计 -->
            <div class="achievement-stats">
                <div class="stat-card">
                    <div class="stat-label">总成就</div>
                    <div class="stat-value" id="totalAchievements">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">已解锁</div>
                    <div class="stat-value" id="unlockedAchievements">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">完成度</div>
                    <div class="stat-value" id="achievementProgress">0%</div>
                </div>
            </div>

            <!-- 成就筛选 -->
            <div class="achievement-filter">
                <button class="filter-btn active" data-filter="all">全部</button>
                <button class="filter-btn" data-filter="unlocked">已解锁</button>
                <button class="filter-btn" data-filter="locked">未解锁</button>
                <button class="filter-btn" data-filter="cumulative">跨局累积</button>
                <button class="filter-btn" data-filter="session">单局成就</button>
            </div>

            <!-- 成就列表 -->
            <div class="achievement-list" id="achievementList">
                <!-- 动态生成 -->
            </div>
        </div>
    </div>

    <!-- 游戏结束弹窗 -->
    <div class="modal" id="gameOverModal" style="display: none;">
        <div class="modal-content">
            <h2 class="modal-title">游戏结束!</h2>
            <div class="winner-text" id="winnerText"></div>
            <div class="stats-container">
                <div class="stat-item">
                    <div class="stat-label">玩家1分数</div>
                    <div class="stat-value player1-color" id="finalScore1">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">玩家2分数</div>
                    <div class="stat-value player2-color" id="finalScore2">0</div>
                </div>
            </div>
            <button id="restartBtn" class="btn btn-primary">再来一局</button>
        </div>
    </div>

    <!-- 成就解锁通知 -->
    <div class="achievement-notification" id="achievementNotification">
        <div class="achievement-icon">🏆</div>
        <div class="achievement-info">
            <div class="achievement-name"></div>
            <div class="achievement-desc"></div>
            <div class="achievement-user"></div>
        </div>
    </div>

    <!-- 加载所有JS模块 -->
    <script type="module" src="main.js"></script>
</body>
</html>

